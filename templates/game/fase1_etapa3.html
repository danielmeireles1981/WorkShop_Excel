{% extends 'base.html' %}
{% block content %}
<h2>ğŸŒŠ Etapa 3 â€” Mar da LÃ³gica (SOMASE, SOMASES, MÃ‰DIASE, CONT.SE + SE/E/OU)</h2>

<!-- âœ¨ abertura: visÃ£o e propÃ³sito -->
<section class="bloco teoria destaque">
  <h3>âœ¨ De nÃºmeros soltos a respostas inteligentes</h3>
  <p>Agora vocÃª aprende a <strong>filtrar, somar, contar e tirar mÃ©dias</strong> com base em <em>critÃ©rios</em>.
     Ã‰ o salto que transforma uma planilha em um <strong>painel de insights</strong> â€” perfeito para analisar
     gastos por categoria, mÃªs, faixa de valor e atÃ© mÃºltiplas condiÃ§Ãµes.</p>

  <div class="grid-2">
    <div>
      <h4>ğŸ¯ Objetivos da etapa</h4>
      <ul class="check">
        <li>Usar <strong>=SOMASE</strong> e <strong>=MÃ‰DIASE</strong> para cÃ¡lculos por critÃ©rio.</li>
        <li>Usar <strong>=SOMASES</strong> (mÃºltiplos critÃ©rios) e <strong>=CONT.SE</strong>.</li>
        <li>Combinar tudo com <strong>SE/E/OU</strong> para alertas e semÃ¡foros.</li>
      </ul>
    </div>
    <div>
      <h4>âŒ¨ï¸ Atalhos Ãºteis</h4>
      <ul class="tips">
        <li><code>Ctrl + T</code> â†’ Transformar em Tabela (expansÃ£o automÃ¡tica)</li>
        <li><code>Alt + =</code> â†’ AutoSoma</li>
        <li><code>Ctrl + Shift + $</code> â†’ Formato Moeda</li>
      </ul>
    </div>
  </div>
</section>

<!-- ğŸ“˜ teoria prÃ¡tica e visual -->
<section class="bloco teoria">
  <h3>ğŸ“˜ Teoria em 90 segundos</h3>
  <div class="grid-2">
    <div>
      <ul class="code-bullets">
        <li>ğŸ’¸ <strong>=SOMASE(intervalo; critÃ©rio; intervalo_soma)</strong></li>
        <li>ğŸ’¸ğŸ’¸ <strong>=SOMASES(intervalo_soma; intervalo1; critÃ©rio1; intervalo2; critÃ©rio2; ...)</strong></li>
        <li>ğŸ“Š <strong>=MÃ‰DIASE(intervalo; critÃ©rio; intervalo_mÃ©dia)</strong></li>
        <li>ğŸ”¢ <strong>=CONT.SE(intervalo; critÃ©rio)</strong></li>
      </ul>
      <p class="hint">CritÃ©rios podem ser texto (ex.: <code>"AlimentaÃ§Ã£o"</code>), nÃºmeros (<code>&gt;=300</code>) ou datas.</p>
    </div>
    <div class="callout info">
      <strong>Erros comuns</strong>
      <ul>
        <li>Trocar a ordem em <code>SOMASE</code> (lembre: primeiro o <em>intervalo do critÃ©rio</em>, depois o <em>intervalo a somar</em>).</li>
        <li>CritÃ©rio numÃ©rico sem aspas quando usa operadores: use <code>">=300"</code>.</li>
        <li>Misturar nÃºmeros com texto â€œR$ 300â€: formate como nÃºmero/moeda.</li>
      </ul>
    </div>
  </div>
</section>

<!-- ğŸ§  exemplo guiado -->
<section class="bloco exemplo">
  <h3>ğŸ§  Exemplo guiado: â€œMapa de Despesas por CritÃ©rioâ€</h3>
  <p>Use a tabela abaixo (ou similar). Dica: transforme em Tabela com <strong>Ctrl + T</strong> para facilitar.</p>

  <table>
    <tr><th>Data</th><th>Categoria</th><th>DescriÃ§Ã£o</th><th>Valor</th><th>MÃªs</th></tr>
    <tr><td>01/03/2025</td><td>AlimentaÃ§Ã£o</td><td>Mercado</td><td>250</td><td>Mar</td></tr>
    <tr><td>04/03/2025</td><td>Transporte</td><td>Ã”nibus</td><td>80</td><td>Mar</td></tr>
    <tr><td>10/03/2025</td><td>AlimentaÃ§Ã£o</td><td>Restaurante</td><td>120</td><td>Mar</td></tr>
    <tr><td>22/03/2025</td><td>Lazer</td><td>Cinema</td><td>60</td><td>Mar</td></tr>
    <tr><td>03/04/2025</td><td>AlimentaÃ§Ã£o</td><td>Mercado</td><td>280</td><td>Abr</td></tr>
  </table>

  <div class="grid-2">
    <div>
      <h4>ğŸ’¡ CÃ¡lculos por critÃ©rio</h4>
      <pre><code>
# Total alimentacao (1 critÃ©rio)
=SOMASE(B2:B6;"AlimentaÃ§Ã£o";D2:D6)

# Total alimentacao em MARÃ‡O (2 critÃ©rios)
=SOMASES(D2:D6; B2:B6;"AlimentaÃ§Ã£o"; E2:E6;"Mar")

# MÃ©dia de gastos em Transporte
=MÃ‰DIASE(B2:B6;"Transporte";D2:D6)

# Quantas despesas acima de 100?
=CONT.SE(D2:D6;">100")
      </code></pre>
    </div>
    <div class="callout success">
      <strong>Combos com SE</strong>
      <pre><code>
# Alerta se AlimentaÃ§Ã£o em MAR >= 500
=SE(SOMASES(D2:D6;B2:B6;"AlimentaÃ§Ã£o";E2:E6;"Mar")>=500;"âš ï¸ Alto";"OK")

# Sinal verde se qtd. de gastos &gt; 100 for zero
=SE(CONT.SE(D2:D6;">100")=0;"âœ”ï¸ Controle OK";"AtenÃ§Ã£o")
      </code></pre>
      <p class="hint">Combine com FormataÃ§Ã£o Condicional para semÃ¡foros automÃ¡ticos.</p>
    </div>
  </div>
</section>

<!-- ğŸ’ª desafio gamificado -->
<section class="bloco desafio">
  <h3>ğŸ’ª MÃ£o na massa: â€œPainel de Categorias Inteligentesâ€</h3>
  <p>Monte um painel com 5 indicadores e 2 alertas automÃ¡ticos.</p>

  <div class="grid-2">
    <div>
      <h4>ğŸ“Œ Indicadores</h4>
      <ul class="plain">
        <li>Total em AlimentaÃ§Ã£o (mÃªs atual) â†’ <strong>SOMASES</strong></li>
        <li>Total em Transporte (mÃªs atual) â†’ <strong>SOMASES</strong></li>
        <li>MÃ©dia por categoria â€œLazerâ€ â†’ <strong>MÃ‰DIASE</strong></li>
        <li>Contagem de despesas &gt;= R$ 300 â†’ <strong>CONT.SE</strong></li>
        <li>Total geral de despesas do mÃªs â†’ <strong>SOMASES</strong> por MÃªs</li>
      </ul>
    </div>
    <div>
      <h4>ğŸš¦ Alertas</h4>
      <ul class="plain">
        <li><strong>AlimentaÃ§Ã£o</strong> â‰¥ 40% do total do mÃªs â†’ â€œConcentradoâ€</li>
        <li>NÂº de despesas &gt;= 300 â‰¥ 3 â†’ â€œRiscoâ€</li>
      </ul>
      <pre><code>
# % AlimentaÃ§Ã£o do mÃªs (supondo Total_Mes em X2 e Total_Alim_Mes em X3)
=SE(X3>=0,4*X2;"Concentrado";"OK")

# Risco por quantidade de gastos altos (supondo contagem em Y3)
=SE(Y3>=3;"Risco";"EstÃ¡vel")
      </code></pre>
      <p class="hint">Dica: crie uma cÃ©lula â€œMÃªs selecionadoâ€ (ex.: "Mar") e use como critÃ©rio nas fÃ³rmulas.</p>
    </div>
  </div>

  <div class="badges">
    <span class="badge">ğŸ… SOMASE Master</span>
    <span class="badge">ğŸ“Š MÃ©dia por CritÃ©rio</span>
    <span class="badge">ğŸš¦ Alertas LÃ³gicos</span>
  </div>
</section>

<!-- ğŸï¸ modo turbo -->
<section class="bloco extra">
  <h3>ğŸï¸ Modo Turbo (opcional)</h3>
  <div class="grid-2">
    <div class="callout info">
      <strong>ParÃ¢metros dinÃ¢micos</strong><br>
      Crie uma cÃ©lula â€œ<em>MÃªs Selecionado</em>â€ (ex.: <code>H1 = "Mar"</code>) e â€œ<em>Categoria</em>â€ (<code>H2 = "AlimentaÃ§Ã£o"</code>).<br>
      Depois: <code>=SOMASES(D:D;B:B;H2;E:E;H1)</code> â€” troca os filtros sem mexer na fÃ³rmula.
    </div>
    <div class="callout info">
      <strong>Sem PROCV ainda (spoiler da Etapa 4)</strong><br>
      Se tiver uma â€œTabela de Metas por Categoriaâ€, vocÃª pode usar <code>SE()</code> comparando
      o total real com a meta da categoria (na Etapa 4 entraremos com PROCV/PROCH).
    </div>
  </div>
</section>

<!-- âœ… checklist -->
<section class="bloco teoria">
  <h3>âœ… Checklist â€” pronto para a Etapa 4?</h3>
  <ul class="check">
    <li>Usei <strong>SOMASE</strong>, <strong>SOMASES</strong>, <strong>MÃ‰DIASE</strong> e <strong>CONT.SE</strong>.</li>
    <li>ConstruÃ­ 5 indicadores por critÃ©rio (mÃªs/categoria).</li>
    <li>Implementei alertas com <strong>SE</strong> (e, se possÃ­vel, semÃ¡foros visuais).</li>
    <li>Parametrizei â€œMÃªsâ€ e â€œCategoriaâ€ para filtros dinÃ¢micos.</li>
  </ul>
  <p class="hint">Se estÃ¡ tudo ok, avance para o <strong>Castelo das Buscas</strong> (PROCV/PROCH/CORRESP+ÃNDICE) e conecte suas bases! ğŸ°</p>
</section>

<a href="{% url 'etapa4' %}" class="btn-next">Ir para Etapa 4 (PROCV, PROCH, CORRESP+ÃNDICE) â¡ï¸</a>
{% endblock %}
