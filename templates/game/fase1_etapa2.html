{% extends 'base.html' %}
{% load static %}
{% block body_class %}fase-1{% endblock %}
{% block content %}
<h2>ğŸ”¥ Etapa 2 â€” Montanha das CondiÃ§Ãµes (SE, E, OU)</h2>

<!-- âœ¨ abertura motivacional -->
<section class="bloco teoria destaque">
  <h3>âœ¨ Planilhas que pensam</h3>
  <p>Agora o Excel ganha cÃ©rebro. Com <strong>SE</strong>, <strong>E</strong> e <strong>OU</strong>, sua planilha
     passa a <em>tomar decisÃµes</em>: classifica, aprova, alerta e recomenda. Ã‰ aqui que relatÃ³rios ficam <strong>inteligentes</strong>.</p>

  <div class="grid-2">
    <div>
      <h4>ğŸ¯ Objetivos da etapa</h4>
      <ul class="check">
        <li>Dominar <strong>=SE()</strong> para regras bÃ¡sicas e mensagens dinÃ¢micas.</li>
        <li>Combinar <strong>=SE()</strong> com <strong>=E()</strong> e <strong>=OU()</strong>.</li>
        <li>Criar <strong>semÃ¡foros visuais</strong> para status (aprovado/risco/atenÃ§Ã£o).</li>
      </ul>
    </div>
    <div>
      <h4>âŒ¨ï¸ Atalhos Ãºteis (Windows)</h4>
      <ul class="tips">
        <li><code>Ctrl + 1</code> â†’ Formatar cÃ©lulas</li>
        <li><code>Alt + H + L</code> â†’ FormataÃ§Ã£o condicional</li>
        <li><code>F2</code> â†’ Editar cÃ©lula (ver fÃ³rmulas)</li>
      </ul>
    </div>
  </div>
</section>

<!-- ğŸ“˜ teoria enxuta e visual -->
<section class="bloco teoria">
  <h3>ğŸ“˜ Teoria em 90 segundos</h3>
  <div class="grid-2">
    <div>
      <ul class="code-bullets">
        <li>âš–ï¸ SE â†’ <code>=SE(teste_lÃ³gico; valor_se_verdadeiro; valor_se_falso)</code></li>
        <li>ğŸ¤ E  â†’ <code>=E(cond1; cond2; ...)</code> (todas verdadeiras)</li>
        <li>ğŸ”€ OU â†’ <code>=OU(cond1; cond2; ...)</code> (qualquer verdadeira)</li>
      </ul>
      <p class="hint">Regra de ouro: primeiro pense a <strong>frase lÃ³gica</strong> (â€œse saldo â‰¥ 0 entÃ£oâ€¦ senÃ£oâ€¦â€), depois transforme em fÃ³rmula.</p>
    </div>
    <div class="callout info">
      <strong>Erros comuns</strong>
      <ul>
        <li>Esquecer <em>;</em> como separador de argumentos (PT-BR usa ponto e vÃ­rgula).</li>
        <li>Comparar texto sem aspas â†’ use <code>"Aprovado"</code>.</li>
        <li>Ordem das condiÃ§Ãµes em SE aninhado confusa â†’ escreva a regra antes, em portuguÃªs.</li>
      </ul>
    </div>
  </div>
</section>

<!-- ğŸ§  exemplo guiado -->
<section class="bloco exemplo">
  <h3>ğŸ§  Exemplo guiado: â€œTermÃ´metro do MÃªsâ€</h3>
  <p>VocÃª tem um <strong>Saldo</strong> (Receitas âˆ’ Despesas) e quer classificar o mÃªs:</p>
  <ul class="plain">
    <li>Saldo â‰¥ 500 â†’ <strong>Excelente</strong></li>
    <li>0 â‰¤ Saldo &lt; 500 â†’ <strong>Ok</strong></li>
    <li>Saldo &lt; 0 â†’ <strong>AtenÃ§Ã£o</strong></li>
  </ul>

  <div class="grid-2">
    <div>
      <h4>ğŸ”¢ FÃ³rmulas</h4>
      <pre><code>
# Saldo em C2 (ex.: C2 = Receitas - Despesas)

# VersÃ£o com SE aninhado
=SE(C2>=500;"Excelente";SE(C2>=0;"Ok";"AtenÃ§Ã£o"))

# VersÃ£o â€œfalandoâ€ com E()
=SE(E(C2>=0; C2<500);"Ok"; SE(C2>=500;"Excelente"; "AtenÃ§Ã£o"))

# Bandeira simples (bom/ruim)
=SE(C2>=0;"SOBROU";"FALTOU")

# Alerta OU: mÃªs crÃ­tico se saldo &lt; 0 OU (despesa &gt;= 70% da receita)
=SE(OU(C2&lt;0; Despesas>=0,7*Receitas);"CrÃ­tico";"EstÃ¡vel")
      </code></pre>
    </div>
    <div class="callout success">
      <strong>SemÃ¡foro visual (2 min)</strong>
      <ol>
        <li>Selecione a cÃ©lula â€œClassificaÃ§Ã£oâ€.</li>
        <li>FormataÃ§Ã£o Condicional â†’ â€œRegras de realceâ€ â†’ â€œTexto que contÃ©mâ€.</li>
        <li>â€œExcelenteâ€ (verde), â€œOkâ€ (amarelo), â€œAtenÃ§Ã£oâ€ (vermelho).</li>
      </ol>
      <p class="hint">Ou use â€œConjuntos de Ã­conesâ€ (semÃ¡foros) para ficar ainda mais visual.</p>
    </div>
  </div>
</section>

<!-- ğŸ’ª desafio gamificado -->
<section class="bloco desafio">
  <h3>ğŸ’ª MÃ£o na massa: â€œRadar Financeiroâ€</h3>
  <p>Monte um radar de status do mÃªs com 3 indicadores inteligentes.</p>

  <div class="callout info" style="margin-top: 16px;">
    <strong>ğŸ“¦ Dataset Sugerido:</strong> <a href="{% static 'datasets/descontos.xls' %}" class="btn-next" download style="margin:0; padding: 6px 10px; font-size: .9rem;">Baixar base</a><br>
    <strong>MissÃ£o:</strong> Implemente regras de desconto progressivo com SE/E/OU e sinalize o desconto aplicado.
  </div>

  <div class="grid-2">
    <div>
      <h4>ğŸ“Œ Indicador 1 â€” Status do Saldo</h4>
      <ul class="plain">
        <li>Use o <strong>SE aninhado</strong> (Excelente / Ok / AtenÃ§Ã£o).</li>
        <li>Ative o semÃ¡foro (FormataÃ§Ã£o Condicional).</li>
      </ul>

      <h4>ğŸ“Œ Indicador 2 â€” Meta de Economia</h4>
      <ul class="plain">
        <li>Meta em D2 (ex.: R$ 400) e Economia em E2.</li>
        <li><code>=SE(E(E2>=D2; Saldo>=0);"Meta atingida";"A ajustar")</code></li>
      </ul>
    </div>

    <div>
      <h4>ğŸ“Œ Indicador 3 â€” Risco de Gastos</h4>
      <ul class="plain">
        <li>Despesas &gt;= 80% das Receitas <strong>OU</strong> 2 categorias acima de R$ 300 â†’ â€œRiscoâ€.</li>
        <li>SugestÃ£o de fÃ³rmula (ajuste seus intervalos):<br>
          <code>=SE(OU(Despesas>=0,8*Receitas; Qtd_Categorias_Acima300>=2);"Risco";"Ok")</code>
        </li>
      </ul>

      <div class="callout warning">
        <strong>Bonus visual:</strong> pinte automaticamente a linha de qualquer despesa &gt;= R$ 300.
      </div>
    </div>
  </div>

  <div class="badges">
    <span class="badge">ğŸ… LÃ³gica Clara</span>
    <span class="badge">ğŸš¦ SemÃ¡foro Pro</span>
    <span class="badge">ğŸ§© CombinaÃ§Ãµes E/OU</span>
  </div>

  <div class="callout success" style="margin-top: 20px;">
    <h4>ğŸ“¤ Envie seu trabalho</h4>
    <form method="post" action="{% url 'submit_etapa' %}" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="hidden" name="etapa_id" value="f1e2">
      <label for="planilha_f1e2">Selecione sua planilha:</label>
      <input type="file" name="planilha" id="planilha_f1e2" required>
      <button type="submit" class="btn-submit">Submeter Planilha</button>
    </form>
  </div>
</section>

<!-- ğŸï¸ modo turbo -->
<section class="bloco extra">
  <h3>ğŸï¸ Modo Turbo (opcional)</h3>
  <div class="grid-2">
    <div class="callout info">
      <strong>SE + TEXTO colorido</strong><br>
      Em uma cÃ©lula, exiba recomendaÃ§Ãµes automÃ¡ticas:<br>
      <code>=SE(Saldo&lt;0;"Reduzir Lazer 10%";"Manter plano")</code><br>
      Dica: combine com um <em>comentÃ¡rio</em> explicando o porquÃª.
    </div>
    <div class="callout info">
      <strong>ValidaÃ§Ã£o + SE</strong><br>
      Use ValidaÃ§Ã£o de Dados para â€œMetaâ€ (mÃ­n. 0). Mostre alerta:<br>
      <code>=SE(Meta&lt;0;"Meta invÃ¡lida";"")</code>
    </div>
  </div>
</section>

<!-- âœ… checklist final -->
<section class="bloco teoria">
  <h3>âœ… Checklist â€” pronto para a Etapa 3?</h3>
  <ul class="check">
    <li>Criei classificaÃ§Ãµes dinÃ¢micas com <strong>SE</strong>.</li>
    <li>Usei <strong>E</strong> e <strong>OU</strong> para regras mais ricas.</li>
    <li>Ativei semÃ¡foros/cores com FormataÃ§Ã£o Condicional.</li>
    <li>Montei 3 indicadores do meu â€œRadar Financeiroâ€.</li>
  </ul>
  <p class="hint">Se tudo ok, partimos para a combinaÃ§Ã£o de <strong>operaÃ§Ãµes + condicionais</strong> na Etapa 3! ğŸ’¡</p>
</section>

<a href="{% url 'etapa3' %}" class="btn-next">Ir para Etapa 3 (SOMASE, MÃ‰DIASE + lÃ³gica) â¡ï¸</a>
{% endblock %}
