{% extends 'base.html' %}
{% block content %}
<h2>ğŸ“Š Fase 2 â€” Etapa 2: Resumos AutomÃ¡ticos (KPIs com SOMASES, MÃ‰DIASE, CONT.SE)</h2>

<!-- âœ¨ abertura motivacional -->
<section class="bloco teoria destaque">
  <h3>âœ¨ Do dado bruto ao insight</h3>
  <p>Agora que sua <strong>base de lanÃ§amentos</strong> existe (Etapa 1), vamos transformÃ¡-la em
     <strong>KPIs</strong> e <strong>resumos automÃ¡ticos</strong> que mostram o que importa: quanto vocÃª ganha, gasta e como estÃ¡ seu saldo â€” por mÃªs e por categoria.</p>

  <div class="grid-2">
    <div>
      <h4>ğŸ¯ Objetivos da etapa</h4>
      <ul class="check">
        <li>Construir KPIs: <em>Total de Receitas</em>, <em>Total de Despesas</em>, <em>Saldo</em>.</li>
        <li>Gerar resumos por <strong>MÃªs</strong> e por <strong>Categoria</strong>.</li>
        <li>Criar <strong>indicadores visuais</strong> (semafÃ³ricos) para leitura rÃ¡pida.</li>
      </ul>
    </div>
    <div>
      <h4>âŒ¨ï¸ Atalhos Ãºteis</h4>
      <ul class="tips">
        <li><code>Ctrl + T</code> â†’ ReferÃªncias estruturadas (mais legÃ­vel)</li>
        <li><code>Alt + =</code> â†’ AutoSoma</li>
        <li><code>Alt + H + L</code> â†’ FormataÃ§Ã£o Condicional</li>
      </ul>
    </div>
  </div>
</section>

<!-- ğŸ“˜ teoria express -->
<section class="bloco teoria">
  <h3>ğŸ“˜ Conceitos-chave para resumos</h3>
  <div class="grid-2">
    <div>
      <ul class="code-bullets">
        <li><strong>Tabelas</strong> (Ctrl + T) geram cabeÃ§alhos como <code>[Data]</code>, <code>[Tipo]</code>, <code>[Valor]</code>.</li>
        <li><strong>=SOMASES</strong> filtra por mÃºltiplos critÃ©rios (mÃªs, tipo, categoria).</li>
        <li><strong>=MÃ‰DIASE</strong> calcula mÃ©dias condicionais (ex.: ticket mÃ©dio por categoria).</li>
        <li><strong>=CONT.SE</strong> ajuda a contar ocorrÃªncias (ex.: nÂº de despesas &gt;= 300).</li>
      </ul>
      <p class="hint">ParÃ¢metros dinÃ¢micos (cÃ©lulas â€œMÃªs Selecionadoâ€, â€œCategoriaâ€) tornam o resumo interativo sem mexer nas fÃ³rmulas.</p>
    </div>
    <div class="callout info">
      <strong>Layout recomendado dos KPIs</strong>
      <ul>
        <li>Bloco 1: KPIs do mÃªs (Receitas, Despesas, Saldo).</li>
        <li>Bloco 2: Top categorias do mÃªs.</li>
        <li>Bloco 3: Indicadores (ticket mÃ©dio, nÂº de lanÃ§amentos).</li>
      </ul>
    </div>
  </div>
</section>

<!-- ğŸ§  exemplo guiado -->
<section class="bloco exemplo">
  <h3>ğŸ§  Exemplo guiado: â€œKPIs do MÃªsâ€</h3>
  <p>Suponha a Tabela <strong>Lanc</strong> com colunas: <em>Data, DescriÃ§Ã£o, Categoria, Tipo, Valor, MÃªs</em> (da Etapa 1).</p>

  <div class="grid-2">
    <div>
      <h4>ğŸ“Œ ParÃ¢metros (fora da Tabela)</h4>
      <table>
        <tr><th>CÃ©lula</th><th>DescriÃ§Ã£o</th><th>Exemplo</th></tr>
        <tr><td>H1</td><td>MÃªs Selecionado</td><td>Mar</td></tr>
        <tr><td>H2</td><td>Categoria Selecionada</td><td>AlimentaÃ§Ã£o</td></tr>
      </table>

      <h4>ğŸ”¢ FÃ³rmulas dos KPIs</h4>
      <pre><code>
# Total de Receitas (mÃªs)
=SOMASES(Lanc[Valor]; Lanc[MÃªs]; H1; Lanc[Tipo]; "Receita")

# Total de Despesas (mÃªs)
=SOMASES(Lanc[Valor]; Lanc[MÃªs]; H1; Lanc[Tipo]; "Despesa")

# Saldo (mÃªs)
=KPI_Receitas - KPI_Despesas
      </code></pre>
    </div>

    <div class="callout success">
      <strong>Resumo por Categoria (no mÃªs)</strong>
      <p>Em uma pequena tabela auxiliar (Categoria x Total no mÃªs):</p>
      <pre><code>
# Em cÃ©lula ao lado de cada Categoria (ex.: A12 = "AlimentaÃ§Ã£o")
=SOMASES(Lanc[Valor]; Lanc[MÃªs]; H1; Lanc[Categoria]; A12; Lanc[Tipo]; "Despesa")

# Ticket mÃ©dio da Categoria Selecionada no mÃªs
=MÃ‰DIASE(Lanc[Valor]; Lanc[Categoria]; H2)
      </code></pre>
      <p class="hint">Destaque a <em>categoria lÃ­der</em> do mÃªs com MÃXIMO e cor especial.</p>
    </div>
  </div>
</section>

<!-- ğŸ’ª desafio gamificado -->
<section class="bloco desafio">
  <h3>ğŸ’ª MÃ£o na massa: â€œPainel Express do MÃªsâ€</h3>
  <p>Construa um <strong>painel de KPIs</strong> com filtros por MÃªs e (opcional) Categoria.</p>

  <div class="grid-2">
    <div>
      <h4>ğŸ“Œ KPIs obrigatÃ³rios</h4>
      <ul class="plain">
        <li><strong>Total de Receitas (mÃªs)</strong> â€” SOMASES</li>
        <li><strong>Total de Despesas (mÃªs)</strong> â€” SOMASES</li>
        <li><strong>Saldo (mÃªs)</strong> â€” diferenÃ§a</li>
        <li><strong>Top Categoria de Despesa (mÃªs)</strong> â€” SOMASES por categoria + MÃXIMO</li>
        <li><strong>Ticket MÃ©dio de Despesa (mÃªs)</strong> â€” MÃ‰DIASE</li>
      </ul>
    </div>

    <div>
      <h4>ğŸš¦ Indicadores/Alertas</h4>
      <ul class="plain">
        <li>Saldo &lt; 0 â†’ â€œAtenÃ§Ã£oâ€ (vermelho), caso contrÃ¡rio â€œOKâ€ (verde).</li>
        <li>Despesas â‰¥ 70% das Receitas â†’ â€œRiscoâ€ (laranja).</li>
        <li>Qtd. de despesas â‰¥ 300 â‰¥ 3 â†’ â€œConcentradoâ€ (amarelo).</li>
      </ul>
      <pre><code>
# Risco por proporÃ§Ã£o de despesas
=SE(KPI_Despesas >= 0,7*KPI_Receitas; "Risco"; "OK")

# Qtd. de despesas â‰¥ 300 (mÃªs)
=CONT.SES(Lanc[Valor]; ">=300"; Lanc[MÃªs]; H1; Lanc[Tipo]; "Despesa")
      </code></pre>
      <p class="hint">Aplique FormataÃ§Ã£o Condicional (semÃ¡foros/cores) para leitura instantÃ¢nea.</p>
    </div>
  </div>

  <div class="badges">
    <span class="badge">ğŸ… KPIs Claros</span>
    <span class="badge">âš¡ SOMASES Pro</span>
    <span class="badge">ğŸš¦ Alertas Visuais</span>
  </div>
</section>

<!-- ğŸï¸ modo turbo -->
<section class="bloco extra">
  <h3>ğŸï¸ Modo Turbo (opcional)</h3>
  <div class="grid-2">
    <div class="callout info">
      <strong>Tabela de Metas + ComparaÃ§Ã£o</strong><br>
      Crie uma aba â€œMetasâ€ (MÃªs, Categoria, Meta_R$). Busque a meta da categoria/mÃªs e compare:<br>
      <code>=SE(Total_Categ_Mes > Meta; "Acima da meta"; "Dentro da meta")</code><br>
      (Na Etapa 4 da Fase 1 vocÃª viu como usar PROCV ou ÃNDICE+CORRESP)
    </div>
    <div class="callout info">
      <strong>ParÃ¢metros mÃºltiplos</strong><br>
      Adicione â€œTipo Selecionadoâ€ (H2 = Receita/Despesa) e replique KPIs com um clique:<br>
      <code>=SOMASES(Lanc[Valor]; Lanc[MÃªs]; H1; Lanc[Tipo]; H2)</code>
    </div>
  </div>
</section>

<!-- âœ… checklist -->
<section class="bloco teoria">
  <h3>âœ… Checklist â€” pronto para a Etapa 3?</h3>
  <ul class="check">
    <li>Tenho KPIs do mÃªs (Receitas, Despesas, Saldo) funcionando.</li>
    <li>Resumos por Categoria no mÃªs (com identificaÃ§Ã£o da lÃ­der).</li>
    <li>Alertas visuais (saldo, proporÃ§Ã£o de despesas, concentraÃ§Ã£o).</li>
    <li>(Opcional) ParÃ¢metros dinÃ¢micos e metas comparativas.</li>
  </ul>
  <p class="hint">Com os resumos prontos, a prÃ³xima etapa Ã© transformar isso em <strong>grÃ¡ficos e indicadores visuais</strong> envolventes! ğŸ“ˆ</p>
</section>

<a href="{% url 'fase2_etapa3' %}" class="btn-next">Ir para Etapa 3 (GrÃ¡ficos & Indicadores) â¡ï¸</a>
{% endblock %}
