{% extends 'base.html' %}
{% load static %}
{% block body_class %}fase-2{% endblock %}
{% block content %}
<h2>ğŸ’° Fase 2 â€” Etapa 1: LanÃ§amentos de Receitas e Despesas</h2>

<!-- âœ¨ Abertura motivacional -->
<section class="bloco teoria destaque">
  <h3>âœ¨ O coraÃ§Ã£o do seu controle financeiro</h3>
  <p>Sem <strong>lanÃ§amentos organizados</strong> nÃ£o existe painel confiÃ¡vel. Aqui vocÃª cria a <em>base de dados</em> da sua planilha:
     datas, descriÃ§Ãµes, tipos e valores â€” tudo limpo, validado e pronto para gerar <strong>resumos, grÃ¡ficos e indicadores</strong>.</p>

  <div class="grid-2">
    <div>
      <h4>ğŸ¯ Objetivos da etapa</h4>
      <ul class="check">
        <li>Construir a tabela de lanÃ§amentos (Receita/Despesa).</li>
        <li>Aplicar <strong>formato de moeda</strong> e <strong>data</strong> corretamente.</li>
        <li>Usar <strong>ValidaÃ§Ã£o de Dados</strong> (lista â€œReceita/Despesaâ€).</li>
        <li>Transformar em <strong>Tabela</strong> (Ctrl + T) para crescer com qualidade.</li>
      </ul>
    </div>
    <div>
      <h4>âŒ¨ï¸ Atalhos ninja (Windows)</h4>
      <ul class="tips">
        <li><code>Ctrl + T</code> â†’ Criar Tabela</li>
        <li><code>Ctrl + ;</code> â†’ Inserir data de hoje</li>
        <li><code>Ctrl + Shift + $</code> â†’ Formato Moeda</li>
        <li><code>Alt + â†“</code> â†’ Abrir lista de validaÃ§Ã£o</li>
      </ul>
    </div>
  </div>
</section>

<!-- ğŸ“˜ Teoria express -->
<section class="bloco teoria">
  <h3>ğŸ“˜ Boas prÃ¡ticas de dados</h3>
  <div class="grid-2">
    <div>
      <ul class="code-bullets">
        <li><strong>Uma linha = um lanÃ§amento</strong> (nada de mesclar cÃ©lulas).</li>
        <li>Colunas claras: <em>Data, DescriÃ§Ã£o, Categoria, Tipo, Valor, MÃªs</em>.</li>
        <li><strong>Tipo</strong> deve ser padronizado (lista: â€œReceitaâ€, â€œDespesaâ€).</li>
        <li><strong>Valor</strong> Ã© nÃºmero (sem â€œR$â€ digitado como texto).</li>
      </ul>
      <p class="hint">Dados bem estruturados = resumos fÃ¡ceis (SOMASES, MÃ‰DIASE, grÃ¡ficosâ€¦).</p>
    </div>
    <div class="callout info">
      <strong>Erros comuns</strong>
      <ul>
        <li>Escrever â€œR$ 250â€ em vez de apenas <code>250</code> (formate como moeda).</li>
        <li>Misturar grafias (â€œreceitaâ€, â€œReceitaâ€, â€œRECEITAâ€).</li>
        <li>Deixar colunas faltando (categoria, tipo, mÃªs).</li>
      </ul>
    </div>
  </div>
</section>

<!-- ğŸ§  Exemplo guiado -->
<section class="bloco exemplo">
  <h3>ğŸ§  Exemplo guiado: â€œMinha base de lanÃ§amentosâ€</h3>
  <p>Crie uma planilha com as colunas abaixo e, depois, transforme em <strong>Tabela</strong> (Ctrl + T).</p>

  <table>
    <tr><th>Data</th><th>DescriÃ§Ã£o</th><th>Categoria</th><th>Tipo</th><th>Valor</th><th>MÃªs</th></tr>
    <tr><td>01/03/2025</td><td>SalÃ¡rio</td><td>Renda</td><td>Receita</td><td>2500</td><td>Mar</td></tr>
    <tr><td>02/03/2025</td><td>Mercado</td><td>AlimentaÃ§Ã£o</td><td>Despesa</td><td>280</td><td>Mar</td></tr>
    <tr><td>05/03/2025</td><td>Uber</td><td>Transporte</td><td>Despesa</td><td>42</td><td>Mar</td></tr>
    <tr><td>10/03/2025</td><td>Venda online</td><td>Renda</td><td>Receita</td><td>180</td><td>Mar</td></tr>
  </table>

  <div class="grid-2">
    <div>
      <h4>ğŸ”§ Passos essenciais</h4>
      <ol>
        <li>Selecione a Ã¡rea â†’ <strong>Ctrl + T</strong> â†’ marque â€œMinha tabela tem cabeÃ§alhosâ€.</li>
        <li>Coluna <em>Tipo</em>: <strong>ValidaÃ§Ã£o de Dados</strong> â†’ Lista â†’ <code>Receita,Despesa</code>.</li>
        <li>Coluna <em>Valor</em>: <strong>Moeda</strong> (Ctrl + Shift + $).</li>
        <li>Coluna <em>MÃªs</em>: preencha com abreviaÃ§Ãµes (â€œJanâ€, â€œFevâ€, â€œMarâ€â€¦)
            ou use <code>=TEXTO([@Data];"MMM")</code> se preferir automÃ¡tico.</li>
      </ol>
    </div>
    <div class="callout success">
      <strong>Mini-resumo imediato</strong>
      <pre><code>
# Em cÃ©lulas fora da tabela (ex.: K2:K5):

Total Receitas  =SOMASES([Valor];[Tipo];"Receita")
Total Despesas  =SOMASES([Valor];[Tipo];"Despesa")
Saldo           =K2-K3
Ticket MÃ©dio $  =MÃ‰DIASE([Valor];[Tipo];"Despesa")
      </code></pre>
      <p class="hint">Usando Tabela, os cabeÃ§alhos viram <em>referÃªncias estruturadas</em> â€” mais legÃ­veis e robustas.</p>
    </div>
  </div>
</section>

<!-- ğŸ’ª Desafio gamificado -->
<section class="bloco desafio">
  <h3>ğŸ’ª MÃ£o na massa: â€œBase blindada + Resumo instantÃ¢neoâ€</h3>
  <p>Monte sua prÃ³pria base e crie um resumo ao lado. Valha-se de validaÃ§Ãµes para evitar erros.</p>

  <div class="callout info" style="margin-top: 16px;">
    <strong>ğŸ“¦ Dataset Sugerido:</strong> <a href="{% static 'datasets/fluxo_de_caixa.xls' %}" class="btn-next" download style="margin:0; padding: 6px 10px; font-size: .9rem;">Baixar base</a><br>
    <strong>MissÃ£o:</strong> Crie KPIs do mÃªs + resumo por categoria + status (Excelente/Ok/AtenÃ§Ã£o) com regras visuais.
  </div>

  <div class="grid-2">
    <div>
      <h4>ğŸ“Œ Requisitos da base</h4>
      <ul class="plain">
        <li>6+ linhas reais (misture receitas e despesas).</li>
        <li>ValidaÃ§Ã£o em <strong>Tipo</strong> (apenas â€œReceitaâ€ ou â€œDespesaâ€).</li>
        <li><strong>MÃªs</strong> automÃ¡tico: <code>=TEXTO([@Data];"MMM")</code>.</li>
        <li>Formato de <strong>Valor</strong> como moeda.</li>
      </ul>
      <div class="callout warning">
        <strong>Anti-erro:</strong> em <em>Categoria</em>, crie uma lista (ValidaÃ§Ã£o) com itens como
        <em>Renda, AlimentaÃ§Ã£o, Transporte, Lazer, Moradia, SaÃºde</em>.
      </div>
    </div>

    <div>
      <h4>ğŸ“Œ Resumo imediato</h4>
      <ul class="plain">
        <li><strong>Total Receitas</strong> (SOMASES por Tipo)</li>
        <li><strong>Total Despesas</strong> (SOMASES por Tipo)</li>
        <li><strong>Saldo</strong> (Receitas âˆ’ Despesas)</li>
        <li><strong>Maior Despesa</strong> (MÃXIMO filtrando Tipo = â€œDespesaâ€ â€” opcional)</li>
        <li><strong>Qtd. lanÃ§amentos</strong> (CONT.VALORES / CONT.SE â€” opcional)</li>
      </ul>
      <pre><code>
# Ex.: Maior Despesa (faÃ§a com filtro auxiliar "SÃ³ Despesa" ou use MÃXIMOSES no Excel 365)
=MÃXIMO(SE([Tipo]="Despesa";[Valor]))
(Confirme como matriz legada com Ctrl+Shift+Enter se necessÃ¡rio)
      </code></pre>
    </div>
  </div>

  <div class="badges">
    <span class="badge">ğŸ… Base Limpa</span>
    <span class="badge">ğŸ›¡ï¸ ValidaÃ§Ã£o Pro</span>
    <span class="badge">âš¡ Resumo InstantÃ¢neo</span>
  </div>

  <div class="callout success" style="margin-top: 20px;">
    <h4>ğŸ“¤ Envie seu trabalho</h4>
    <form method="post" action="{% url 'submit_etapa' %}" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="hidden" name="etapa_id" value="f2e1">
      <label for="planilha_f2e1">Selecione sua planilha:</label>
      <input type="file" name="planilha" id="planilha_f2e1" required>
      <button type="submit" class="btn-submit">Submeter Planilha</button>
    </form>
  </div>
</section>

<!-- ğŸï¸ Modo Turbo -->
<section class="bloco extra">
  <h3>ğŸï¸ Modo Turbo (opcional)</h3>
  <div class="grid-2">
    <div class="callout info">
      <strong>ParÃ¢metros dinÃ¢micos</strong><br>
      Crie cÃ©lulas â€œ<em>MÃªs Selecionado</em>â€ (ex.: H1 = "Mar") e â€œ<em>Tipo Selecionado</em>â€ (H2 = "Despesa").<br>
      Depois: <code>=SOMASES([Valor];[MÃªs];H1;[Tipo];H2)</code> â€” um resumo filtrÃ¡vel sem mexer nas fÃ³rmulas.
    </div>
    <div class="callout info">
      <strong>Data-entrada inteligente</strong><br>
      Adicione uma coluna â€œ<em>Data de Cadastro</em>â€ com <code>=HOJE()</code> (ou registre via macro/formulÃ¡rio).
      Ãštil para auditoria e dashboards temporais.
    </div>
  </div>
</section>

<!-- âœ… Checklist -->
<section class="bloco teoria">
  <h3>âœ… Checklist â€” pronto para a Etapa 2?</h3>
  <ul class="check">
    <li>Tenho Tabela com colunas: Data, DescriÃ§Ã£o, Categoria, Tipo, Valor, MÃªs.</li>
    <li>Tipo validado (lista) e Valor formatado como Moeda.</li>
    <li>Resumo com Totais e Saldo funcionando.</li>
    <li>(Opcional) ParÃ¢metros dinÃ¢micos para MÃªs e Tipo.</li>
  </ul>
  <p class="hint">Com a base feita, na prÃ³xima etapa criaremos <strong>resumos automÃ¡ticos</strong> poderosos (SOMASES, indicadores, saldo) e deixaremos tudo pronto para os <strong>grÃ¡ficos</strong>. ğŸš€</p>
</section>

<a href="{% url 'fase2_etapa2' %}" class="btn-next">Ir para Etapa 2 (Resumos AutomÃ¡ticos) â¡ï¸</a>
{% endblock %}
