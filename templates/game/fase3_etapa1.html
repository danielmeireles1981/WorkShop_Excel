{% extends 'base.html' %}
{% load static %}
{% block content %}
<h2>ğŸ¤ Fase 3 â€” Etapa 1: ApresentaÃ§Ã£o do Dashboard + Ranking</h2>

<!-- âœ¨ Abertura: intenÃ§Ã£o e energia -->
<section class="bloco teoria destaque">
  <h3>âœ¨ Hora do show: dados que viram decisÃ£o</h3>
  <p>VocÃª vai apresentar seu <strong>Dashboard Final</strong> em atÃ© <strong>5 minutos</strong>, contando a histÃ³ria do seu mÃªs:
     o que aconteceu, por quÃª e o que vocÃª recomenda. Depois, registre sua entrega e acompanhe o <strong>ranking ao vivo</strong>.</p>

  <div class="grid-2">
    <div>
      <h4>ğŸ¯ Objetivos</h4>
      <ul class="check">
        <li>Entregar um <strong>pitch claro, visual e objetivo</strong> (atÃ© 5min).</li>
        <li>Comprovar consistÃªncia dos seus nÃºmeros (base â†’ KPIs â†’ grÃ¡ficos).</li>
        <li>Registrar sua apresentaÃ§Ã£o e pontuar no <strong>ranking</strong>.</li>
      </ul>
    </div>
    <div>
      <h4>âŒ› CronÃ´metro de 5 min</h4>
      <div class="callout info">
        <div id="timer" style="font-size:1.8rem;font-weight:700;">05:00</div>
        <button id="startTimer" class="btn-next" type="button">â–¶ï¸ Iniciar</button>
        <button id="resetTimer" class="btn-next" type="button">âŸ² Reset</button>
      </div>
    </div>
  </div>
</section>

<!-- ğŸ“˜ Teoria enxuta: como contar a histÃ³ria -->
<section class="bloco teoria">
  <h3>ğŸ“˜ Roteiro de pitch em 5 passos</h3>
  <ol>
    <li><strong>Contexto</strong>: qual pergunta seu dashboard responde? (ex.: â€œEquilÃ­brio financeiro em marÃ§oâ€)</li>
    <li><strong>2â€“3 KPIs-chave</strong>: receitas, despesas, saldo (+ 1 indicador relevante do seu caso)</li>
    <li><strong>2 evidÃªncias visuais</strong>: grÃ¡fico de categorias + evoluÃ§Ã£o do saldo</li>
    <li><strong>Insight</strong>: por que aconteceu? (categoria lÃ­der, picos, concentraÃ§Ã£o, sazonalidade)</li>
    <li><strong>AÃ§Ã£o recomendada</strong>: o que fazer no prÃ³ximo mÃªs (meta, corte, realocaÃ§Ã£o)</li>
  </ol>
  <p class="hint">TÃ­tulo = â€œo quÃª + quando + ondeâ€. Ex.: <em>â€œDespesas concentradas em AlimentaÃ§Ã£o (38%) â€” MarÃ§o/2025â€</em>.</p>
</section>

<!-- ğŸ§  Exemplo guiado de narrativa -->
<section class="bloco exemplo">
  <h3>ğŸ§  Exemplo de narrativa</h3>
  <p>â€œEm marÃ§o, as despesas foram <strong>68% das receitas</strong>, com <strong>AlimentaÃ§Ã£o</strong> liderando (R$ 530).
     O saldo ficou <strong>positivo</strong> graÃ§as a freelance de R$ 300. <strong>Risco</strong> se despesas seguirem acima de 70%.
     <strong>Plano</strong>: reduzir alimentaÃ§Ã£o em 10% e limitar transporte a R$ 250.â€</p>
  <div class="callout success">
    <strong>Checklist do slide 1 (Resumo):</strong> KPIs + status do mÃªs (Excelente/Ok/AtenÃ§Ã£o) + 1 frase de insight.
  </div>
</section>

<!-- ğŸ’ª Desafio prÃ¡tico -->
<section class="bloco desafio">
  <h3>ğŸ’ª MÃ£o na massa: apresente e registre</h3>
  <div class="grid-2">
    <div>
      <h4>ğŸ“¦ Entrega mÃ­nima</h4>
      <ul class="plain">
        <li>Dashboard com: KPIs do mÃªs, grÃ¡fico Receitas x Despesas, grÃ¡fico por Categoria, linha do Saldo.</li>
        <li>ParÃ¢metros visÃ­veis (MÃªs; opcional Categoria/Tipo).</li>
        <li>TÃ­tulos e rÃ³tulos legÃ­veis; semÃ¡foros claros.</li>
      </ul>
      <div class="callout warning">
        <strong>Qualidade:</strong> se algo â€œnÃ£o fechaâ€, revise sua base (Etapa 1) e KPIs (Etapa 2).
      </div>
    </div>

    <div>
      <h4>ğŸ“ Registro da apresentaÃ§Ã£o</h4>
      <form method="post" action="{% url 'fase3_submit' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="grid-2">
          <div>
            <label><strong>Resumo (2â€“3 linhas)</strong></label>
            <textarea name="resumo" required placeholder="Qual foi o principal insight do mÃªs?"></textarea>
          </div>
          <div>
            <label><strong>Link/Arquivo (opcional)</strong></label>
            <input type="url" name="link" placeholder="Link do arquivo na nuvem (Drive/OneDrive)" />
            <input type="file" name="anexo" />
          </div>
        </div>
        <label><strong>AutoavaliaÃ§Ã£o (0 a 10)</strong></label>
        <input type="number" name="auto_score" min="0" max="10" step="0.5" required />
        <button type="submit" class="btn-next">ğŸ“¤ Enviar apresentaÃ§Ã£o & marcar pontos</button>
      </form>
      <p class="hint">A pontuaÃ§Ã£o final pode considerar rubrica do instrutor e, opcionalmente, nota de pares.</p>
    </div>
  </div>
</section>

<!-- ğŸ† Ranking ao vivo -->
<section class="bloco teoria">
  <h3>ğŸ† Ranking</h3>
  {% if top_scores %}
  <table>
    <tr><th>#</th><th>Jogador</th><th>Avatar</th><th>Pontos</th><th>Atualizado</th></tr>
    {% for s in top_scores %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td>{{ s.user.username }}</td>
      <td style="font-size:1.2rem;">{{ s.user.profile.avatar }}</td>
      <td><strong>{{ s.points_total }}</strong></td>
      <td>{{ s.updated_at|date:"d/m H:i" }}</td>
    </tr>
    {% endfor %}
  </table>
  {% else %}
  <p>NinguÃ©m no ranking ainda. Seja <strong>o primeiro</strong> a pontuar! ğŸš€</p>
  {% endif %}
</section>

<!-- âœ… Checklist de fechamento -->
<section class="bloco teoria">
  <h3>âœ… Checklist rÃ¡pido</h3>
  <ul class="check">
    <li>Roteiro de 5 passos preparado.</li>
    <li>Dashboard com KPIs e 2+ grÃ¡ficos limpos.</li>
    <li>Insight e aÃ§Ã£o recomendada claros.</li>
    <li>Entrega registrada e pontuada.</li>
  </ul>

  <div style="display:flex; gap:10px; flex-wrap:wrap;">
    <a href="{% url 'fase2_final' %}" class="btn-next">â¬…ï¸ Revisar Fase 2</a>
    <a href="{% url 'game_home' %}" class="btn-next">ğŸ  Voltar ao Mapa</a>
  </div>
</section>

<!-- â±ï¸ Timer JS -->
<script>
(function(){
  let sec = 300; // 5 min
  let tId = null;
  const el = document.getElementById('timer');
  const start = document.getElementById('startTimer');
  const reset = document.getElementById('resetTimer');

  function render(){
    const m = String(Math.floor(sec/60)).padStart(2,'0');
    const s = String(sec%60).padStart(2,'0');
    el.textContent = `${m}:${s}`;
    if(sec <= 10){ el.style.color = '#c62828'; el.style.fontWeight = '800'; }
  }
  function tick(){ if(sec>0){ sec--; render(); } else { clearInterval(tId); } }

  start?.addEventListener('click', ()=>{ if(tId) return; tId = setInterval(tick,1000); });
  reset?.addEventListener('click', ()=>{ clearInterval(tId); tId=null; sec=300; el.style.color=''; el.style.fontWeight='700'; render(); });
  render();
})();
</script>
{% endblock %}
